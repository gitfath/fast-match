generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String   @id @default(uuid())
  email         String?  @unique
  phone         String?  @unique
  password      String
  referralCode  String?  @unique
  referredById  String?
  referredBy    User?    @relation("Referrals", fields: [referredById], references: [id])
  referrals     User[]   @relation("Referrals")
  createdAt     DateTime @default(now())
  profile       Profile?
  likesSent     Like[]   @relation("LikesSent")
  likesRec      Like[]   @relation("LikesReceived")
  matches       Match[]  @relation("UserMatches")
  wallet        Wallet?
  bookings      Booking[]
  payments      Payment[]
  role          String   @default("MEMBER") // MEMBER, PARTNER, ADMIN
  business      Business?
  
  reportsSent   Report[]   @relation("ReportedBy")
  reportsRec    Report[]   @relation("ReportedUser")
  sanctions     Sanction[]
  sanctionsMade Sanction[] @relation("AdminSanctions")
  tickets       SupportTicket[]
}


model Wallet {
  id            String   @id @default(uuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  balanceFCFA   Float    @default(0)
  balancePoints Int      @default(0)
  transactions  Transaction[]
  updatedAt     DateTime @updatedAt
}

model Transaction {
  id          String   @id @default(uuid())
  walletId    String
  wallet      Wallet   @relation(fields: [walletId], references: [id])
  amount      Float
  currency    String   // "FCFA" or "POINTS"
  type        String   // "EARN", "REDEEM", "WITHDRAW", "REFERRAL"
  description String
  status      String   @default("COMPLETED") // PENDING, COMPLETED, FAILED
  reference   String?  @unique
  createdAt   DateTime @default(now())
}

model Business {
  id            String   @id @default(uuid())
  name          String
  type          String   // Restaurant, Bar, Cinema, etc.
  address       String
  city          String?
  neighborhood  String?
  mapsUrl       String?
  latitude      Float?
  longitude     Float?
  phone         String
  email         String   @unique
  openingHours  String?
  cashbackRate  Float    @default(0)
  description   String?
  photos        String?  // JSON array of strings
  verified      Boolean  @default(false)
  bookings      Booking[]
  ownerId       String   @unique
  owner         User     @relation(fields: [ownerId], references: [id])
  createdAt     DateTime @default(now())
}

model Booking {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id])
  businessId      String
  business        Business @relation(fields: [businessId], references: [id])
  matchId         String?
  match           Match?   @relation(fields: [matchId], references: [id])
  date            DateTime
  numPeople       Int      @default(2)
  estimatedAmount Float?
  cashbackAmount  Float?
  status          String   @default("PENDING") // PENDING, CONFIRMED, COMPLETED, CANCELLED
  message         String?
  createdAt       DateTime @default(now())
}

model Profile {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  
  // 1Ô∏è‚É£ IDENTIT√â DE BASE
  name      String
  pseudo    String?
  birthDate DateTime? // Pour calcul pr√©cis de l'√¢ge
  age       Int
  gender    String   // Homme, Femme, Non-binaire, Transgenre homme, Transgenre femme, Autre, Pr√©f√®re ne pas dire
  orientation String? // H√©t√©rosexuel(le), Homosexualit√©, Bisexuel(le), Pansexuel(le), Asexuel(le), Questionnement, Autre, Pr√©f√®re ne pas dire
  languages String?  // JSON array: ["Fran√ßais", "√âw√©", "Kaby√®", etc.]
  
  // 2Ô∏è‚É£ LOCALISATION
  country   String?  // Togo, Autre pays africain, Europe, Am√©rique, Autre
  city      String?  // Lom√©, Kara, Sokod√©, Atakpam√©, Dapaong, Autre
  location     String?  // Coordonn√©es ou adresse g√©n√©rale
  neighborhood String?  // Quartier (Texte libre)
  mobility  String?  // Fixe, Mobile occasionnel, Tr√®s mobile, Voyage souvent
  
  // 3Ô∏è‚É£ OBJECTIF DE RENCONTRE
  relationshipGoal String? // S√©rieuse, Mariage, Amicale, Occasionnelle, Flirt, Discussion seulement, Je ne sais pas encore
  openToDistance   String? // Oui, Non, Peut-√™tre
  
  // 4Ô∏è‚É£ PERSONNALIT√â
  personalityType String? // Introverti(e), Extraverti(e), Ambiverti(e)
  temperament     String? // Calme, √ânergique, Passionn√©(e), R√©serv√©(e), Sociable, Leader, Cr√©atif(ve)
  humorImportance String? // Tr√®s important, Important, Peu important, Pas important
  
  // 5Ô∏è‚É£ CENTRES D'INT√âR√äT
  interests Interest[]
  
  // 6Ô∏è‚É£ SITUATION PERSONNELLE
  relationshipStatus String? // C√©libataire, En couple, S√©par√©(e), Divorc√©(e), Veuf/Veuve
  children           String? // Aucun, 1, 2, 3+, Pr√©f√®re ne pas dire
  wantsChildren      String? // Oui, Non, Peut-√™tre, Plus tard
  
  // 7Ô∏è‚É£ √âTUDES & TRAVAIL
  educationLevel String? // Aucun, Primaire, Coll√®ge, Lyc√©e, Universitaire, Master, Doctorat
  profession     String? // Texte libre
  jobStatus      String? // √âtudiant(e), Salari√©(e), Entrepreneur(e), Fonctionnaire, Sans emploi, Freelance, Autre
  
  // 8Ô∏è‚É£ RELIGION & VALEURS
  religion         String? // Chr√©tien(ne), Musulman(e), Traditionnelle, Autre, Aucune, Pr√©f√®re ne pas dire
  religiousPractice String? // Pas pratiquant(e), Peu pratiquant(e), Pratiquant(e), Tr√®s pratiquant(e)
  values           String? // JSON array: ["Famille", "Respect", "Fid√©lit√©", etc.]
  
  // 9Ô∏è‚É£ APPARENCE PHYSIQUE
  height      String? // < 1m60, 1m60 ‚Äì 1m70, 1m70 ‚Äì 1m80, > 1m80
  bodyType    String? // Mince, Moyenne, Athl√©tique, Ronde, Forte
  style       String? // Classique, Moderne, Sport, Traditionnel, Chic, D√©contract√©
  
  // üîü HABITUDES
  smoking     String? // Non, Occasionnel, R√©gulier
  drinking    String? // Jamais, Occasionnel, R√©gulier
  sports      String? // Jamais, Parfois, R√©guli√®rement
  goingOut    String? // Rarement, Parfois, Souvent
  
  // üîê CONFIDENTIALIT√â
  profileVisibility String? @default("Public") // Public, Priv√©, Visible aux matchs seulement
  messageSettings   String? @default("Matchs seulement") // Tout le monde, Matchs seulement, Personne
  
  // üõ°Ô∏è S√âCURIT√â & STATUT
  verified       Boolean  @default(false)
  phoneVerified  Boolean  @default(false)
  idVerified     Boolean  @default(false)
  accountStatus  String   @default("Actif") // Actif, Suspendu, Banni, En r√©vision
  
  // üìä DONN√âES ALGORITHMIQUES
  activityLevel String   @default("Nouveau") // Nouveau, Actif, Tr√®s actif, Inactif
  isPremium     Boolean  @default(false)
  isBoosted     Boolean  @default(false)
  
  // Autres
  bio         String?
  photos      Photo[]
  contactInfo String?
  preferences Preference?
  updatedAt   DateTime @updatedAt
}

model Preference {
  id          String   @id @default(uuid())
  profileId   String   @unique
  profile     Profile  @relation(fields: [profileId], references: [id])
  
  // Pr√©f√©rences de base
  minAge      Int      @default(18)
  maxAge      Int      @default(50)
  gender      String?  // Homme, Femme, Tout, Non-binaire, etc.
  
  // 2Ô∏è‚É£ LOCALISATION
  distance    Int      @default(50) // km: 1, 5, 10, 25, 50, 100, Sans limite
  preferredCities String? // JSON array
  
  // 3Ô∏è‚É£ OBJECTIF DE RENCONTRE
  relationshipGoal String? // S√©rieuse, Mariage, Amicale, etc.
  openToDistance   String? // Oui, Non, Peut-√™tre
  
  // 4Ô∏è‚É£ PERSONNALIT√â
  personalityType String? // Introverti(e), Extraverti(e), Ambiverti(e), Tout
  temperament     String? // JSON array ou texte
  
  // 6Ô∏è‚É£ SITUATION PERSONNELLE
  relationshipStatus String? // C√©libataire uniquement, Tout
  children           String? // Aucun, Avec enfants, Tout
  wantsChildren      String? // Oui, Non, Peut-√™tre, Tout
  
  // 7Ô∏è‚É£ √âTUDES & TRAVAIL
  minEducationLevel String? // Niveau minimum souhait√©
  jobStatus         String? // JSON array ou texte
  
  // 8Ô∏è‚É£ RELIGION & VALEURS
  religion          String? // M√™me religion, Tout
  religiousPractice String? // Niveau de pratique souhait√©
  importantValues   String? // JSON array
  
  // 9Ô∏è‚É£ APPARENCE PHYSIQUE
  heightRange String? // Plage de taille souhait√©e
  bodyType    String? // JSON array ou texte
  
  // üîü HABITUDES
  smoking  String? // Non fumeur uniquement, Tout
  drinking String? // Pr√©f√©rence alcool
  sports   String? // Sportif, Tout
}

model Photo {
  id        String   @id @default(uuid())
  url       String
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id])
}

model Interest {
  id        String   @id @default(uuid())
  name      String   // Musique, Sport, Danse, Voyage, Lecture, Cin√©ma, Cuisine, etc.
  profileId String
  profile   Profile  @relation(fields: [profileId], references: [id])
}

model Like {
  id         String   @id @default(uuid())
  fromUserId String
  toUserId   String
  liked      Boolean  @default(true)
  createdAt  DateTime @default(now())
  fromUser   User     @relation("LikesSent", fields: [fromUserId], references: [id])
  toUser     User     @relation("LikesReceived", fields: [toUserId], references: [id])

  @@unique([fromUserId, toUserId])
}

model Match {
  id        String   @id @default(uuid())
  users     User[]   @relation("UserMatches")
  createdAt DateTime @default(now())
  messages  Message[]
  bookings  Booking[]
}

model Message {
  id        String   @id @default(uuid())
  matchId   String
  match     Match    @relation(fields: [matchId], references: [id])
  senderId  String
  content   String
  status    String   @default("SENT") // PENDING, SENT, DELIVERED, READ
  type      String   @default("text") // text, image, audio
  createdAt DateTime @default(now())
}

model Payment {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  amount      Float
  status      String   // PENDING, COMPLETED, FAILED, REFUNDED
  provider    String   // TMONEY, MOOV, STRIPE
  reference   String?  @unique
  description String?
  createdAt   DateTime @default(now())
}

model Report {
  id              String   @id @default(uuid())
  reporterId      String
  reportedId      String
  reason          String
  description     String?
  status          String   @default("PENDING") // PENDING, RESOLVED, DISMISSED
  urgency         String   @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  contentSnapshot String?  // Optional snapshot of the reported content
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  reporter        User     @relation("ReportedBy", fields: [reporterId], references: [id])
  reported        User     @relation("ReportedUser", fields: [reportedId], references: [id])
}

model Sanction {
  id            String   @id @default(uuid())
  userId        String
  adminId       String
  type          String   // WARNING, SUSPENSION, BAN, LEGAL
  reason        String
  expiresAt     DateTime?
  active        Boolean  @default(true)
  createdAt     DateTime @default(now())
  
  user          User     @relation(fields: [userId], references: [id])
  admin         User     @relation("AdminSanctions", fields: [adminId], references: [id])
}

model SupportTicket {
  id          String   @id @default(uuid())
  userId      String
  subject     String
  description String
  status      String   @default("OPEN") // OPEN, IN_PROGRESS, RESOLVED, CLOSED
  priority    String   @default("NORMAL") // NORMAL, URGENT
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user        User     @relation(fields: [userId], references: [id])
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String?
  type        String   // SUBSCRIPTION, CONSUMABLE
  price       Float
  quantity    Int?     // For consumables (e.g., 5 Super Likes)
  duration    Int?     // For subscriptions (e.g., 30 days)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
}

